\documentclass{article}
\usepackage{mathtools}
\usepackage{stmaryrd}
\usepackage{relsize}
\usepackage{listings}

\input{macros}

\setlength{\parindent}{0cm}

\begin{document}
\newcommand{\translate}[2]{\ensuremath{\llbracket\texttt{#2}\rrbracket_{\textnormal{#1}}}}
\newcommand{\fresh}[1]{\ensuremath{x^*_{#1}}}
\newcommand{\secheader}[1]{\par\noindent{\sc #1}\noindent\unskip}

We use the notation $\translate{type}{\ensuremath{n}}$ to represent the translation of a node $n$ of type $type$ from LittleBang into TinyBangNested.  We define translations for the following types of nodes:

\begin{itemize}
    \item \emph{expressions} ($e$)
    \item \emph{patterns} ($p$)
    \item \emph{parameters} ($P$)
    \item \emph{arguments} ($a$)
    \item \emph{members} ($m$)
\end{itemize}

Within a translation, we use the symbol $\fresh{n}$ to denote the $n$th fresh variable; fresh variables with the same subscript within one translation rule are identical, but fresh variables appearing within distinct translation rules are distinct.

\vspace*{3mm}
\secheader{Expressions}

\translate{e}{fun $P_1$,$\ldots$,$P_n$ -> $e$} = \lbil!fun !\bigamp{i=1}{n}\translate{P}{$P_i$} \lbil!->! \translate{e}{$e$} \\
\translate{e}{$x$\texttt{(}$a_1$,$\ldots$,$a_n$\texttt{)}} = $x$\lbil!(! \bigamp{i=1}{n}\translate{a}{$a_i$}\lbil!)!\\
\translate{e}{if $e_1$ then $e_2$ else $e_3$} = \lbil!((`True () -> !\translate{e}{$e_2$}\lbil!) & (`False () -> !\translate{e}{$e_3$}\lbil!)) !\translate{e}{$e_1$}\\
\translate{e}{[$e_1$,$...$,$e_n$]} = \listhd \translate{e}{$e_1$}\lbonion\listtl \lbil!(...(!\listhd\translate{e}{$e_n$}\lbonion\listtl \lbil!`Nil ()))!\\
\translate{e}{$e_1$; $e_2$} = \lbil!(!\fresh{1} \lbil!->! \translate{e}{$e_2$}\lbil!)! \translate{e}{$e_1$}\\
\translate{e}{$e_1$ :: $e_2$} = \listhd\translate{e}{$e_1$}\lbonion\listtl\translate{e}{$e_2$}\\
\translate{e}{\char`\{$a_1$,$\ldots$,$a_n$\char`\}} = \bigamp{i=1}{n} \translate{a}{$a_i$}\\
\translate{e}{object \char`\{$m_1$ $\ldots$ $m_n$\char`\}} = \lbseal\lbil!(!\bigamp{i=1}{n} \translate{m}{$m_i$}\lbil!)!\\
\translate{e}{$e$.$x$} = \lbil!(fun `!$x~x$ \lbil!->! $x$\lbil!) (!$e$\lbil!)! \\
\translate{e}{$e$.$m$($a_1$,$\ldots$,$a_n$)} = $e$\lbil!(!\bigamp{i=1}{n}\translate{a}{$a_i$}\lbil!)! \\

\secheader{Parameters}

\translate{P}{$x$} = \verb|(`|$x\texttt{ }x$\verb|)| \\
\translate{P}{$x$:$p$} = \verb|(`|$x$\verb! (!$x$\verb| & |\translate{p}{$p$}\verb|))| \\

\secheader{Patterns}

\translate{p}{[$p_1$,$...$,$p_n$]} = \listhd\translate{p}{$p_1$}\lbonion\listtl \lbil!(!\listhd\translate{p}{$p_2$} \listtl $\ldots$\listtl\lbil!`Nil ()!$\ldots$\lbil!)! \\

\secheader{Arguments}

\translate{a}{$x$=$e$} = \bt$x$\verb| |\translate{e}{$e$} \\

\secheader{Members}

\translate{m}{$x$=$e$} = \bt$x$\verb| |\translate{e}{$e$} \\
\translate{m}{$x$($P_1$,$\ldots$,$P_n$)=$e$} = \lbil!fun !\bigamp{i=1}{n}\translate{P}{$P_i$} \lbil!->! \translate{e}{$e$} \\
\end{document}
