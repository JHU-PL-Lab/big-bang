\documentclass{article}
\usepackage{mathtools}
\usepackage{stmaryrd}
\usepackage{listings}

\newcommand{\setlb}{%
    \lstset{%
        basicstyle=\small\ttfamily,%
        numbers=none,%
        firstnumber=auto,%
    }%
}
\lstnewenvironment{code}%
    {\setlb}%
    {}%
\newcommand{\lbil}{\setlb\lstinline[mathescape]}

\setlength{\parindent}{0cm}

\begin{document}
\newcommand{\translate}[2]{\ensuremath{\llbracket\texttt{#2}\rrbracket_{\textnormal{#1}}}}
\newcommand{\fresh}[1]{\ensuremath{x^*_{#1}}}
\newcommand{\secheader}[1]{\par\noindent{\sc #1}\noindent\unskip}

We use the notation $\translate{type}{\ensuremath{n}}$ to represent the translation of a node $n$ of type $type$ from LittleBang into TinyBangNested.  We define translations for the following types of nodes:

\begin{itemize}
    \item \emph{expressions} ($e$)
    \item \emph{patterns} ($p$)
    \item \emph{parameters} ($P$)
    \item \emph{arguments} ($a$)
    \item \emph{members} ($m$)
\end{itemize}

Within a translation, we use the symbol $\fresh{n}$ to denote the $n$th fresh variable; fresh variables with the same subscript within one translation rule are identical, but fresh variables appearing within distinct translation rules are distinct.

\vspace*{3mm}
\secheader{Expressions}

\translate{e}{fun $P_1$,$\ldots$,$P_n$ -> $e$} = \verb|fun |\translate{P}{$P_1$}\verb| & |$\ldots$\verb| & |\translate{P}{$P_n$}\verb| -> |\translate{e}{$e$} \\
\translate{e}{$x$\texttt{(}$a_1$,$\ldots$,$a_n$\texttt{)}} = $x$\verb| (|\translate{a}{$a_1$}\verb| & ... & |\translate{a}{$a_n$}\verb|)|\\
\translate{e}{if $e_1$ then $e_2$ else $e_3$} = \verb|((`True () -> |\translate{e}{$e_2$}\verb|) & (`False () -> |\translate{e}{$e_3$}\verb|)) |\translate{e}{$e_1$}\\
\translate{e}{[$e_1$,$...$,$e_n$]} = \verb|`Hd |\translate{e}{$e_1$}\verb| & `Tl (...(`Hd |\translate{e}{$e_n$}\verb| & `Tl `Nil ()))|\\
\translate{e}{$e_1$; $e_2$} = \verb|(|\fresh{1}\verb| -> |\translate{e}{$e_2$}\verb|) |\translate{e}{$e_1$}\\
\translate{e}{$e_1$ :: $e_2$} = \verb|`Hd |\translate{e}{$e_1$}\verb| & `Tl |\translate{e}{$e_2$}\\
\translate{e}{\char`\{$a_1$,$\ldots$,$a_n$\char`\}} = \translate{a}{$a_1$}\verb| & ... & |\translate{a}{$a_n$}\\
\translate{e}{object \char`\{$m_1$ $\ldots$ $m_n$\char`\}} = \verb|seal (|\translate{m}{$m_1$}\verb| & ... & |\translate{m}{$m_n$}\verb|)|\\
\translate{e}{$e$.$x$} = \verb|(fun `$|$x~x$\verb| -> |$x$\verb|) (|$e$\verb|)| \\
\translate{e}{$e$.$m$($a_1$,$\ldots$,$a_n$)} = $e$\verb! (!\translate{a}{$a_1$}\verb| & ... & |\translate{a}{$a_n$}\verb!)! \\

\secheader{Parameters}

\translate{P}{$x$} = \verb|(`$|$x\texttt{ }x$\verb|)| \\
\translate{P}{$x$:$p$} = \verb|(`$|$x$\verb! (!$x$\verb| & |\translate{p}{$p$}\verb|))| \\

\secheader{Patterns}

\translate{p}{[$p_1$,$...$,$p_n$]} = \verb|`Hd |\translate{p}{$p_1$}\verb| & `Tl (`Hd |\translate{p}{$p_2$}\verb| & |$\ldots$\verb| `Tl `Nil ()|$\ldots$\verb|)| \\

\secheader{Arguments}

\translate{a}{$x$=$e$} = \verb|`$|$x$\verb| |\translate{e}{$e$} \\

\secheader{Members}

\translate{m}{$x$=$e$} = \verb|`$|$x$\verb| |\translate{e}{$e$} \\
\translate{m}{$x$($P_1$,$\ldots$,$P_n$)=$e$} = \verb|fun |\translate{P}{$P_1$}\verb| & |$\ldots$\verb| & |\translate{P}{$P_n$}\verb| -> |\translate{e}{$e$} \\
\end{document}
