\usepackage{amsmath,amssymb}
\usepackage{mathpartir}
\usepackage{graphicx}
\usepackage{rotate}
\usepackage{textcomp}

%%% Layout Macros %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% vstack - Command for placing one symbol above or below another.
%   #1 - Amount to lower first symbol
%   #2 - First symbol
%   #3 - Amount to lower second symbol
%   #4 - Second symbol
\newcommand{\vstackAtom}[5]{%
    \rlap{%
        \lower #2\hbox{\ensuremath{#1#3}}%
    }{%
        \lower #4\hbox{\ensuremath{#1#5}}%
    }}
\newcommand*{\vstack}[4]{%
    \ensuremath{%
        \mathchoice%
            {\vstackAtom{\displaystyle}{#1}{#2}{#3}{#4}}%
            {\vstackAtom{\textstyle}{#1}{#2}{#3}{#4}}%
            {\vstackAtom{\scriptstyle}{#1}{#2}{#3}{#4}}%
            {\vstackAtom{\scriptscriptstyle}{#1}{#2}{#3}{#4}}%
        }%
    }

% shrinks text in math mode
\newcommand{\mathsmaller}{\mathchoice{\scriptstyle}{\scriptstyle}{\scriptscriptstyle}{\scriptscriptstyle}}

%%% Notation Macros %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\DeclareMathOperator{\fto}{\rightarrow}

\newcommand{\alphaUp}{\vstack{0em}{\alpha}{-0.5em}{\scalebox{1}[0.5]{\ensuremath{\vartriangle}}}}
\newcommand{\anyAlpha}{\alpha^?}
\newcommand{\alphaOpen}{\vstack{-0.5em}{\mkern2mu\scalebox{0.8}{\textopenbullet}}{0em}{\alpha}}
\newcommand{\alphaClosed}{\vstack{-0.5em}{\mkern2mu\scalebox{0.8}{\textbullet}}{0em}{\alpha}}
\newcommand{\alphaList}{\bar{\alpha}}

\newcommand{\cellDown}[1]{\ensuremath{\vstack{-0.5em}{\scalebox{1}[0.5]{\ensuremath{\mkern3mu\triangledown}}}{0em}{\textrm{cell}}(#1)}}
\newcommand{\cellUpG}[1]{\ensuremath{\vstack{-0.55em}{\scalebox{1}[0.5]{\ensuremath{\mkern3mu\vartriangle}}}{0em}{\textrm{cell}}^G(#1)}}
\newcommand{\cellUpS}[1]{\ensuremath{\vstack{-0.55em}{\scalebox{1}[0.5]{\ensuremath{\mkern3mu\vartriangle}}}{0em}{\textrm{cell}}^S(#1)}}

\newcommand{\tauUpOpen}{\vstack{0em}{\tau}{-0.5em}{\scalebox{1}[0.5]{\ensuremath{\mkern-1mu\vartriangle}}}}
\newcommand{\tauUpClosed}{\vstack{0em}{\tau}{-0.5em}{\scalebox{1}[0.5]{\ensuremath{\mkern-1mu\blacktriangle}}}}
\newcommand{\tauDownOpen}{\vstack{0em}{\tau}{-0.5em}{\scalebox{1}[0.5]{\ensuremath{\mkern-1mu\triangledown}}}}
\newcommand{\tauDownClosed}{\vstack{0em}{\tau}{-0.5em}{\scalebox{1}[0.5]{\ensuremath{\mkern-1mu\blacktriangledown}}}}
\newcommand{\tauChi}{\ensuremath{\tau^\chi}}

\DeclareMathOperator{\zConcreteEquatable}{\ensuremath{\Xi}}
\newcommand{\concreteEquatable}[2]{\zConcreteEquatable(#1,#2)}

\newcommand{\flatten}[1]{\ensuremath{\theta(#1)}}

\DeclareMathOperator{\immCompat}{<::}
\DeclareMathOperator{\icSeparator}{\sim}

%%% Grammar Macros %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\DeclareMathOperator{\gOr}{\vert}

\DeclareMathOperator{\tprim}{\textrm{tprim}}
\DeclareMathOperator{\lbl}{\textrm{lbl}}
\DeclareMathOperator{\subtype}{\textrm{subtype}}
\DeclareMathOperator{\zEquatable}{\ensuremath{\xi}}
\newcommand{\equatable}[2]{\zEquatable(#1,#2)}
\DeclareMathOperator{\constraint}{\textrm{constraint}}
\DeclareMathOperator{\guard}{\textrm{guard}}
\DeclareMathOperator{\cSeparator}{\backslash}
\DeclareMathOperator{\constraintList}{\textrm{C}}
\newcommand{\C}{\ensuremath\constraintList}

\DeclareMathOperator{\gtAmp}{\texttt{\char`\&}}
\DeclareMathOperator{\gtBEq}{%
        \ensuremath{\vstack{0em}{\scalebox{1}[1]{\ensuremath{\square}}}{-0.1em}{\scalebox{0.7}[1]{\ensuremath{\mkern2.75mu=}}}}}
\DeclareMathOperator{\gtFun}{\texttt{fun}}
\DeclareMathOperator{\gtInt}{\texttt{int}}
\DeclareMathOperator{\gtChar}{\texttt{char}}
\DeclareMathOperator{\gtUnit}{\texttt{unit}}
\DeclareMathOperator{\gtTop}{\texttt{top}}
\DeclareMathOperator{\gtBt}{\texttt{`}}
\DeclareMathOperator{\gtCase}{\texttt{case}}
\DeclareMathOperator{\gtOf}{\texttt{of}}
\DeclareMathOperator{\gtBottom}{\ensuremath{\bot}}
\DeclareMathOperator{\gtDef}{\texttt{def}}
\DeclareMathOperator{\gtEq}{\texttt{=}}
\DeclareMathOperator{\gtIn}{\texttt{in}}

%%% Rule Macros %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\context}{\ensuremath{\Gamma}}

\newcommand{\typeRel}[4]{\ensuremath{#1 \vdash #2 : #3 \cSeparator #4}}

\newcommand{\bbrule}[3]{\inferrule*[lab=#1]{#2}{#3}}

